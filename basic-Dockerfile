FROM ghcr.io/nkitsaini/x11base:main

USER root
ARG docker_group_id
ARG USER_NAME=lab
RUN usermod -l ${USER_NAME} -d /home/${USER_NAME} future_user && \
	groupmod -n ${USER_NAME} future_user

RUN mkdir -p /tmp/XDG_RUNTIME_DIR && chmod 777 /tmp/XDG_RUNTIME_DIR
RUN reflector --ipv4 -p "http,https" -n 5 -f 5 -c 'india,' -a 6 --sort rate > /etc/pacman.d/mirrorlist

USER ${USER_NAME}
COPY ./data /tmp/x11-data
COPY ./dotfiles /tmp/dotfiles
COPY ./inits/basic.py /tmp/init.py
RUN python3 /tmp/init.py

USER root
COPY ./startups/basic.py /tmp/startup.py
RUN echo "python3 /tmp/startups/basic.py ${USER_NAME}" > /tmp/start_script.sh
CMD ["bash", "/tmp/start_script.sh"]
